(()=>{"use strict";class t{draw(t,i,s){const e={status:"You Lost!",score:"Score: "+s};t.fillStyle="rgba(0,0,0,0.75)",t.fillRect(0,0,i.width,i.height),t.fillStyle="#FFF",t.font="25px sans-serif",t.fillText(e.status,i.width/2-t.measureText(e.status).width/2,i.height/2-parseInt(t.font)),t.fillText(e.score,i.width/2-t.measureText(e.status).width/2,i.height/2)}}class i{draw(t,i,s){const e={status:"You Won!",score:"Score: "+s};t.fillStyle="rgba(0,0,0,0.75)",t.fillRect(0,0,i.width,i.height),t.fillStyle="#FFF",t.font="25px sans-serif",t.fillText(e.status,i.width/2-t.measureText(e.status).width/2,i.height/2-parseInt(t.font)),t.fillText(e.score,i.width/2-t.measureText(e.status).width/2,i.height/2)}}class s{constructor(t,i,s,e,h){this.x=t,this.y=i,this.width=s,this.height=e,this.color=h}draw(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)}getTop(){return this.y}getBottom(){return this.y+this.height}getLeft(){return this.x}getRight(){return this.x+this.width}}class e extends s{constructor(t,i,s,e,h,a){super(t,i,s,e,h),this.x=t,this.y=i,this.width=s,this.height=e,this.color=h,this.lives=a,this.initialState={destroyed:!1,lives:this.lives},this.destroyed=this.initialState.destroyed}reset(){this.destroyed=this.initialState.destroyed,this.lives=this.initialState.lives}isDestroyed(){return this.destroyed}hit(){this.lives,this.lives--,this.destroyed=!0}}class h{constructor(t,i){this.blocks=t,this.ptsForHit=i,this.combo=0,this.score=0,this.lives=3}reset(){this.lives=3,this.score=0,this.dropCombo(),this.blocks.forEach((t=>t.reset()))}getRemainingBlocks(){return this.blocks.filter((t=>!t.isDestroyed()))}getLives(){return this.lives}incrementLives(){++this.lives}decrementLives(){this.lives&&--this.lives}getScore(){return this.score}getCombo(){return this.combo}dropCombo(){this.combo=0}incrementCombo(){this.combo++}updateScore(t){t&&t instanceof e?(t.hit(),t.isDestroyed()&&(this.score+=this.ptsForHit+this.combo/10*this.ptsForHit),this.incrementCombo()):this.dropCombo()}}class a{constructor(t,i,s,e){this.canvas=t,this.ball=i,this.paddle=s,this.blocks=e,this.stats=new h(this.blocks,10),this.blocksRemaining=this.stats.getRemainingBlocks(),this.gameOver=null}draw(t){var i;this.paddle.draw(t),this.ball.draw(t),this.blocksRemaining.forEach((i=>i.draw(t))),this.drawStats(t),null===(i=this.gameOver)||void 0===i||i.draw(t,this.canvas,this.stats.getScore())}drawStats(t){t.fillStyle="#000",t.font="12px sans-serif",t.textAlign="right",t.fillText("Score: "+this.stats.getScore(),this.canvas.width-5,parseInt(t.font)),this.stats.getCombo()&&t.fillText("Combo: "+this.stats.getCombo(),this.canvas.width-5,2*parseInt(t.font)),t.textAlign="left",t.fillText("Lives: "+this.stats.getLives(),5,parseInt(t.font))}update(){this.paddle.update(),this.blocksRemaining=this.stats.getRemainingBlocks(),this.ball.update([this.paddle,...this.blocksRemaining],this.stats),0===this.blocksRemaining.length?this.gameOver=new i:0===this.stats.getLives()&&(this.gameOver=new t)}reset(){this.paddle.reset(),this.ball.reset(),this.stats.reset(),this.blocksRemaining=this.stats.getRemainingBlocks(),this.gameOver=null}isOver(){return!!this.gameOver}}class l extends s{constructor(t,i,s,e,h,a,l){super(i,s,e,h,a),this.canvas=t,this.x=i,this.y=s,this.width=e,this.height=h,this.color=a,this.speed=l,this.initialState={x:this.x,y:this.y,left:!1,right:!1},this.left=this.initialState.left,this.right=this.initialState.right}update(){this.left&&this.moveLeft(),this.right&&this.moveRight()}reset(){this.x=this.initialState.x,this.y=this.initialState.y,this.left=this.initialState.left,this.right=this.initialState.right}toggleLeft(t){this.left=t}toggleRight(t){this.right=t}getHeight(){return this.height}getWidth(){return this.width}moveLeft(){this.x=this.x-this.speed>=0?this.x-this.speed:0}moveRight(){this.x=this.x+this.width+this.speed<=this.canvas.width?this.x+this.speed:this.canvas.width-this.width}move(t){const i=t-this.width/2;this.x=i<0?0:i>this.canvas.width-this.width?this.canvas.width-this.width:i}}class o{constructor(t,i,s,e,h,a){this.canvas=t,this.paddle=i,this.stepX=s,this.stepY=e,this.radius=h,this.color=a,this.initialState={isMoving:!1,x:this.paddle.getLeft()+this.paddle.getWidth()/2,y:this.canvas.height-this.paddle.getHeight()-(this.radius+5),stepX:this.stepX,stepY:this.stepY},this.x=this.initialState.x,this.y=this.initialState.y,this.isMoving=this.initialState.isMoving}draw(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),t.fill(),t.closePath()}update(t,i){if(this.isMoving){const s=this.detectWallCollision(),e=t.map((t=>this.detectTileCollision(t))).find((t=>t.x||t.y))||{x:!1,y:!1};(s.x||e.x)&&(e.tile&&e.x&&this.moveToBorderX(this.stepX>0?e.tile.getLeft()-this.radius:e.tile.getRight()+this.radius),i.updateScore(e.tile),this.revertXdirection()),(s.y||e.y)&&(e.tile&&e.y&&this.moveToBorderY(this.stepY>0?e.tile.getTop()-this.radius:e.tile.getBottom()+this.radius),i.updateScore(e.tile),this.revertYdirection()),this.move(),this.y-this.radius>=this.canvas.height&&(i.decrementLives(),this.reset())}else this.x=this.paddle.getLeft()+this.paddle.getWidth()/2}reset(){this.isMoving=this.initialState.isMoving,this.x=this.paddle.getLeft()+this.paddle.getWidth()/2,this.y=this.initialState.y,this.stepX=this.initialState.stepX,this.stepY=this.initialState.stepY}setMoving(){this.isMoving=!0}move(){this.x+=this.stepX,this.y+=this.stepY}moveToBorderX(t){this.x=t}moveToBorderY(t){this.y=t}detectTileCollision(t){const i=this.detectTileAngleCollision(t),s={x:this.x+this.radius>=t.getLeft()&&this.x-this.radius<=t.getRight()&&this.y-this.radius>=t.getTop()&&this.y+this.radius<=t.getBottom(),y:this.y+this.radius>=t.getTop()&&this.y-this.radius<=t.getBottom()&&this.x-this.radius>=t.getLeft()&&this.x+this.radius<=t.getRight()||i};return(s.x||s.y)&&(s.tile=t),s}detectTileAngleCollision(t){const i=[Math.abs(this.x-t.getLeft()),Math.abs(this.x-t.getLeft()),Math.abs(this.x-t.getRight()),Math.abs(this.x-t.getRight())],s=[Math.abs(this.y-t.getTop()),Math.abs(this.y-t.getBottom()),Math.abs(this.y-t.getTop()),Math.abs(this.y-t.getBottom())];return!!i.map(((t,i)=>Math.sqrt(Math.pow(t,2)+Math.pow(s[i],2))-this.radius)).find((t=>t<=0))}detectWallCollision(){return{x:this.x-this.radius<=0||this.x+this.radius>=this.canvas.width,y:this.y-this.radius<=0}}revertXdirection(){this.stepX=-this.stepX}revertYdirection(){this.stepY=-this.stepY}}class r{constructor(t,i){this.levelbuilder=t,this.lvl=i,this.canvas=document.getElementById("canvas-BreakOut"),this.ctx=this.canvas.getContext("2d"),this.state=null}start(t,i,s,e,h,r,n,d){const c=new l(this.canvas,(this.canvas.width-t)/2,this.canvas.height-i,t,i,s,e),g=new o(this.canvas,c,n,d,h,r),v=this.levelbuilder.buildLevel(this.lvl);this.state=new a(this.canvas,g,c,v);{const t=t=>{var i,s,e,h;switch(t.keyCode){case 37:null===(i=this.state)||void 0===i||i.paddle.toggleLeft(!0);break;case 39:null===(s=this.state)||void 0===s||s.paddle.toggleRight(!0);break;case 38:null===(e=this.state)||void 0===e||e.ball.setMoving();break;case 32:null===(h=this.state)||void 0===h||h.reset()}},i=t=>{var i,s;switch(t.keyCode){case 37:null===(i=this.state)||void 0===i||i.paddle.toggleLeft(!1);break;case 39:null===(s=this.state)||void 0===s||s.paddle.toggleRight(!1)}},s=t=>{var i;null===(i=this.state)||void 0===i||i.ball.setMoving()},e=t=>{var i;const s=this.canvas.getBoundingClientRect();null===(i=this.state)||void 0===i||i.paddle.move(t.clientX-s.left)};document.addEventListener("keydown",t),document.addEventListener("keyup",i),this.canvas.addEventListener("click",s),this.canvas.addEventListener("mousemove",e)}const u=()=>{var t,i,s;(null===(t=this.state)||void 0===t?void 0:t.isOver())||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),null===(i=this.state)||void 0===i||i.update(),null===(s=this.state)||void 0===s||s.draw(this.ctx)),window.requestAnimationFrame(u)};window.requestAnimationFrame(u)}}class n{constructor(t,i,s,e,h){this.canvas=t,this.startY=i,this.gapX=s,this.gapY=e,this.blockColor=h,this.blockWidth=0,this.blockHeight=15}buildLevel(t){const i=[];if(t.length>10)throw new Error("The level contains to many rows!");return t.forEach(((t,s)=>{this.blockWidth=(this.canvas.width-this.gapX*(t.length+2))/t.length,t.forEach(((t,h)=>{0!==t&&i.push(new e(this.blockWidth*h+this.gapX*(h+1),this.blockHeight*s+this.gapY*s+this.startY,this.blockWidth,this.blockHeight,this.blockColor,t))}))})),i}}!function(){const t=document.getElementById("canvas-BreakOut");new r(new n(t,30,5,5,"#0095DD"),[[0,0,1,1,1,1,0,0],[0,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,0],[0,0,1,1,1,1,0,0]]).start(100,10,"#0095DD",7,10,"#FF4646",5,-5)}()})();